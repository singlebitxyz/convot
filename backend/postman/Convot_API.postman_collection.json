{
    "info": {
        "_postman_id": "convot-api-collection",
        "name": "Convot API",
        "description": "Complete API collection for Convot chatbot platform with bot management, authentication, RAG features, and embeddable widget support.\n\n**Features:**\n- Bot management (CRUD)\n- Widget token management\n- Source management (files & URLs)\n- RAG query engine (authenticated & public widget endpoints)\n- Chat history support (last 5 messages)\n- CORS-enabled widget queries\n- Subscription plan management with usage limits\n- Plan-based feature gating (Train Mode, Analytics)",
        "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
        "_exporter_id": "convot-api"
    },
    "item": [
        {
            "name": "Health & Status",
            "item": [
                {
                    "name": "Health Check",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/health",
                            "host": ["{{base_url}}"],
                            "path": ["health"]
                        },
                        "description": "Check if the API is running and healthy"
                    },
                    "response": []
                },
                {
                    "name": "Root Endpoint",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/",
                            "host": ["{{base_url}}"],
                            "path": [""]
                        },
                        "description": "Get API information and version"
                    },
                    "response": []
                }
            ],
            "description": "Health check and status endpoints"
        },
        {
            "name": "Authentication",
            "item": [
                {
                    "name": "Check User",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/api/v1/check-user",
                            "host": ["{{base_url}}"],
                            "path": ["api", "v1", "check-user"]
                        },
                        "description": "Check if user is authenticated via Supabase cookie.\n\n**Authentication:** Required (via cookie)\n**Features:**\n- Validates authentication token from cookie\n- Returns user information if authenticated\n- Returns 401 if not authenticated"
                    },
                    "response": []
                }
            ],
            "description": "User authentication endpoints"
        },
        {
            "name": "Plan Management",
            "item": [
                {
                    "name": "Get User Plan",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/api/v1/user/plan",
                            "host": ["{{base_url}}"],
                            "path": ["api", "v1", "user", "plan"]
                        },
                        "description": "Get the current authenticated user's subscription plan details.\n\n**Authentication:** Required\n\n**Response:**\n- Returns user's current plan with limits and features:\n  - `plan`: Plan details (plan_key, plan_category, display_name, description)\n  - `plan.max_bots_per_user`: Maximum bots allowed\n  - `plan.max_queries_per_bot_per_day`: Daily query limit per bot (null = unlimited)\n  - `plan.max_docs_per_bot`: Maximum documents per bot\n  - `plan.max_doc_size_mb`: Maximum document size in MB\n  - `plan.max_urls_per_bot`: Maximum URLs per bot\n  - `plan.max_widget_tokens_per_bot`: Maximum widget tokens per bot\n  - `plan.train_enabled`: Whether Train Mode is available\n  - `plan.analytics_tier`: 'basic' or 'full' (full includes Top Queries & Unanswered Queries)\n  - `subscription_id`: Active subscription ID (if any)\n  - `status`: Subscription status\n  - `starts_at`: Subscription start date\n  - `ends_at`: Subscription end date (null for free/lifetime plans)\n\n**Plan Categories:**\n- `free`: Free plan (1 bot, 20 queries/day, 2 docs, 1 URL, basic analytics)\n- `paid1` (Starter): 5 bots, 250 queries/day, 5 docs, 2 URLs, Train Mode, full analytics\n- `paid2` (Growth): 20 bots, unlimited queries, 20 docs, 6 URLs, Train Mode, full analytics\n- `enterprise`: Custom limits, unlimited queries, Train Mode, full analytics"
                    },
                    "response": []
                }
            ],
            "description": "Subscription plan endpoints for viewing user plan details and limitations"
        },
        {
            "name": "Bot Management",
            "item": [
                {
                    "name": "Create Bot",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "type": "text/javascript",
                                "exec": [
                                    "if (pm.response.code === 201) {",
                                    "    var jsonData = pm.response.json();",
                                    "    if (jsonData.data && jsonData.data.id) {",
                                    "        pm.environment.set('bot_id', jsonData.data.id);",
                                    "        console.log('Bot ID saved:', jsonData.data.id);",
                                    "    }",
                                    "}"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"name\": \"My Customer Support Bot\",\n    \"description\": \"A helpful bot for answering customer questions\",\n    \"system_prompt\": \"You are a friendly customer support assistant. Answer questions clearly and professionally.\",\n    \"llm_provider\": \"openai\",\n    \"llm_config\": {\n        \"temperature\": 0.7,\n        \"max_tokens\": 1000,\n        \"model_name\": \"gpt-4o\"\n    },\n    \"retention_days\": 90\n}",
                            "options": {
                                "raw": {
                                    "language": "json"
                                }
                            }
                        },
                        "url": {
                            "raw": "{{base_url}}/api/v1/bots",
                            "host": ["{{base_url}}"],
                            "path": ["api", "v1", "bots"]
                        },
                        "description": "Create a new bot.\n\n**Authentication:** Required\n**Plan Limits:**\n- Checked against `max_bots_per_user` from user's plan\n- Returns 400 error if bot limit is reached\n- Error message includes plan details and upgrade contact email\n\n**Request Body:**\n- `name` (required): Bot name (1-100 characters)\n- `description` (optional): Bot description (max 500 characters)\n- `system_prompt` (optional): Custom system prompt\n- `llm_provider` (optional): 'openai' or 'gemini' (default: 'openai')\n- `llm_config` (optional): LLM configuration\n  - `temperature`: 0.0-2.0 (default: 0.7)\n  - `max_tokens`: 1-4000 (default: 1000)\n  - `model_name`: Model name (default: 'gpt-4o')\n- `retention_days` (optional): Query log retention (1-3650 days, default: 90)\n\n**Response:**\n- Returns created bot with ID\n- Automatically saves bot_id to environment variable\n- Returns 400 with plan limit error if quota exceeded"
                    },
                    "response": []
                },
                {
                    "name": "List Bots",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/api/v1/bots",
                            "host": ["{{base_url}}"],
                            "path": ["api", "v1", "bots"]
                        },
                        "description": "List all bots created by the authenticated user.\n\n**Authentication:** Required\n**Features:**\n- Returns all bots owned by the user\n- Ordered by creation date (newest first)\n- Returns empty array if no bots exist"
                    },
                    "response": []
                },
                {
                    "name": "Get Bot by ID",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/api/v1/bots/{{bot_id}}",
                            "host": ["{{base_url}}"],
                            "path": ["api", "v1", "bots", "{{bot_id}}"]
                        },
                        "description": "Get a specific bot by ID.\n\n**Authentication:** Required\n**Authorization:** Bot must belong to authenticated user\n**Path Parameters:**\n- `bot_id`: Bot UUID\n\n**Response:**\n- Returns bot details if found and authorized\n- Returns 404 if bot not found\n- Returns 403 if user doesn't own the bot"
                    },
                    "response": []
                },
                {
                    "name": "Update Bot",
                    "request": {
                        "method": "PATCH",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"name\": \"Updated Bot Name\",\n    \"description\": \"Updated description\",\n    \"llm_config\": {\n        \"temperature\": 0.8,\n        \"max_tokens\": 1500\n    }\n}",
                            "options": {
                                "raw": {
                                    "language": "json"
                                }
                            }
                        },
                        "url": {
                            "raw": "{{base_url}}/api/v1/bots/{{bot_id}}",
                            "host": ["{{base_url}}"],
                            "path": ["api", "v1", "bots", "{{bot_id}}"]
                        },
                        "description": "Update a bot (partial update supported).\n\n**Authentication:** Required\n**Authorization:** Bot must belong to authenticated user\n**Path Parameters:**\n- `bot_id`: Bot UUID\n\n**Request Body (all fields optional):**\n- `name`: Bot name (1-100 characters)\n- `description`: Bot description (max 500 characters)\n- `system_prompt`: Custom system prompt\n- `llm_provider`: 'openai' or 'gemini'\n- `llm_config`: LLM configuration (partial updates merge with existing)\n- `retention_days`: Query log retention (1-3650 days)\n\n**Response:**\n- Returns updated bot\n- Only provided fields are updated"
                    },
                    "response": []
                },
                {
                    "name": "Delete Bot",
                    "request": {
                        "method": "DELETE",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/api/v1/bots/{{bot_id}}",
                            "host": ["{{base_url}}"],
                            "path": ["api", "v1", "bots", "{{bot_id}}"]
                        },
                        "description": "Delete a bot.\n\n**Authentication:** Required\n**Authorization:** Bot must belong to authenticated user\n**Path Parameters:**\n- `bot_id`: Bot UUID\n\n**Warning:** This action cannot be undone. All associated data (sources, chunks, queries) will be deleted.\n\n**Response:**\n- Returns success message\n- Returns 404 if bot not found\n- Returns 403 if user doesn't own the bot"
                    },
                    "response": []
                }
            ],
            "description": "Bot management endpoints for creating, reading, updating, and deleting chatbots"
        },
        {
            "name": "Widget Token Management",
            "item": [
                {
                    "name": "Create Widget Token",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "type": "text/javascript",
                                "exec": [
                                    "if (pm.response.code === 201) {",
                                    "    var jsonData = pm.response.json();",
                                    "    if (jsonData.data && jsonData.data.id) {",
                                    "        pm.environment.set('widget_token_id', jsonData.data.id);",
                                    "        console.log('Widget Token ID saved:', jsonData.data.id);",
                                    "    }",
                                    "    if (jsonData.token) {",
                                    "        pm.environment.set('widget_token', jsonData.token);",
                                    "        console.log('Widget Token saved (prefix):', jsonData.data.token_prefix);",
                                    "        console.log('⚠️ IMPORTANT: Save the full token from response - it won't be shown again!');",
                                    "    }",
                                    "}"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"name\": \"Production Website Token\",\n    \"allowed_domains\": [\n        \"https://example.com\",\n        \"https://www.example.com\"\n    ],\n    \"expires_at\": null\n}",
                            "options": {
                                "raw": {
                                    "language": "json"
                                }
                            }
                        },
                        "url": {
                            "raw": "{{base_url}}/api/v1/bots/{{bot_id}}/widget-tokens",
                            "host": ["{{base_url}}"],
                            "path": [
                                "api",
                                "v1",
                                "bots",
                                "{{bot_id}}",
                                "widget-tokens"
                            ]
                        },
                        "description": "Create a new widget token for a bot.\n\n**Authentication:** Required\n**Authorization:** Bot must belong to authenticated user\n**Plan Limits:**\n- Checked against `max_widget_tokens_per_bot` from user's plan\n- Returns 400 error if token limit is reached for this bot\n- Error message includes plan details and upgrade contact email\n\n**Path Parameters:**\n- `bot_id`: Bot UUID\n\n**Request Body:**\n- `name` (optional): Descriptive name for the token\n- `allowed_domains` (required): Array of allowed domains/origins\n  - Must include at least one domain\n  - Accepts full URLs (https://example.com) or domain names (example.com)\n  - Supports localhost for development\n- `expires_at` (optional): ISO 8601 timestamp for token expiration\n\n**Response:**\n- Returns token data with plain token (shown only once)\n- **IMPORTANT:** Save the token immediately - it won't be returned again\n- Token is hashed before storage (SHA-256)\n- Token prefix (first 8 chars) is shown for identification\n- Returns 400 with plan limit error if quota exceeded"
                    },
                    "response": []
                },
                {
                    "name": "List Widget Tokens",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/api/v1/bots/{{bot_id}}/widget-tokens",
                            "host": ["{{base_url}}"],
                            "path": [
                                "api",
                                "v1",
                                "bots",
                                "{{bot_id}}",
                                "widget-tokens"
                            ]
                        },
                        "description": "List all widget tokens for a bot.\n\n**Authentication:** Required\n**Authorization:** Bot must belong to authenticated user\n**Path Parameters:**\n- `bot_id`: Bot UUID\n\n**Response:**\n- Returns list of tokens (without plain tokens)\n- Includes token prefix for identification\n- Shows expiration status and last used timestamp\n- Ordered by creation date (newest first)"
                    },
                    "response": []
                },
                {
                    "name": "Revoke Widget Token",
                    "request": {
                        "method": "DELETE",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/api/v1/bots/{{bot_id}}/widget-tokens/{{widget_token_id}}",
                            "host": ["{{base_url}}"],
                            "path": [
                                "api",
                                "v1",
                                "bots",
                                "{{bot_id}}",
                                "widget-tokens",
                                "{{widget_token_id}}"
                            ]
                        },
                        "description": "Revoke (delete) a widget token.\n\n**Authentication:** Required\n**Authorization:** Bot must belong to authenticated user\n**Path Parameters:**\n- `bot_id`: Bot UUID\n- `token_id`: Widget token UUID\n\n**Warning:** This action cannot be undone. The token will immediately stop working for all widget instances.\n\n**Response:**\n- Returns success message\n- Returns 404 if token not found\n- Returns 403 if user doesn't own the bot"
                    },
                    "response": []
                }
            ],
            "description": "Widget token management endpoints for generating and managing tokens for embedding bots on websites"
        },
        {
            "name": "Source Management",
            "item": [
                {
                    "name": "Upload File Source",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "type": "text/javascript",
                                "exec": [
                                    "if (pm.response.code === 201) {",
                                    "    var jsonData = pm.response.json();",
                                    "    if (jsonData.data && jsonData.data.id) {",
                                    "        pm.environment.set('source_id', jsonData.data.id);",
                                    "        console.log('Source ID saved:', jsonData.data.id);",
                                    "    }",
                                    "}"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [],
                        "body": {
                            "mode": "formdata",
                            "formdata": [
                                {
                                    "key": "file",
                                    "type": "file",
                                    "src": [],
                                    "description": "Select a PDF, DOCX, or TXT file to upload (max 50MB)"
                                }
                            ]
                        },
                        "url": {
                            "raw": "{{base_url}}/api/v1/bots/{{bot_id}}/sources/upload",
                            "host": ["{{base_url}}"],
                            "path": [
                                "api",
                                "v1",
                                "bots",
                                "{{bot_id}}",
                                "sources",
                                "upload"
                            ]
                        },
                        "description": "Upload a file source (PDF, DOCX, or TXT) for a bot.\n\n**Authentication:** Required\n**Authorization:** Bot must belong to authenticated user\n**Plan Limits:**\n- Checked against `max_docs_per_bot` from user's plan\n- Checked against `max_doc_size_mb` for file size limit\n- Returns 400 error if document count or size limit is reached\n- Error message includes plan details and upgrade contact email\n\n**Path Parameters:**\n- `bot_id`: Bot UUID\n\n**Request Body:**\n- `file` (required): PDF, DOCX, or TXT file\n  - Free plan: Max 5MB per file, 2 documents per bot\n  - Starter plan: Max 20MB per file, 5 documents per bot\n  - Growth plan: Max 30MB per file, 20 documents per bot\n  - Enterprise plan: Max 100MB per file, 999 documents per bot\n\n**Supported File Types:**\n- PDF: `.pdf`, `application/pdf`\n- DOCX: `.docx`, `application/vnd.openxmlformats-officedocument.wordprocessingml.document`\n- TXT: `.txt`, `text/plain`\n\n**Response:**\n- Returns created source with ID and status\n- File is uploaded to Supabase Storage\n- Source status starts as 'uploaded'\n- Automatically saves source_id to environment variable\n- Returns 400 with plan limit error if quota exceeded"
                    },
                    "response": []
                },
                {
                    "name": "Add URL Source",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "type": "text/javascript",
                                "exec": [
                                    "if (pm.response.code === 201) {",
                                    "    var jsonData = pm.response.json();",
                                    "    if (jsonData.data && jsonData.data.id) {",
                                    "        pm.environment.set('source_id', jsonData.data.id);",
                                    "        console.log('Source ID saved:', jsonData.data.id);",
                                    "    }",
                                    "}"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"source_type\": \"html\",\n    \"original_url\": \"https://example.com/page\"\n}",
                            "options": {
                                "raw": {
                                    "language": "json"
                                }
                            }
                        },
                        "url": {
                            "raw": "{{base_url}}/api/v1/bots/{{bot_id}}/sources/url",
                            "host": ["{{base_url}}"],
                            "path": [
                                "api",
                                "v1",
                                "bots",
                                "{{bot_id}}",
                                "sources",
                                "url"
                            ]
                        },
                        "description": "Submit a URL as a source for a bot.\n\n**Authentication:** Required\n**Authorization:** Bot must belong to authenticated user\n**Plan Limits:**\n- Checked against `max_urls_per_bot` from user's plan\n- Returns 400 error if URL limit is reached for this bot\n- Error message includes plan details and upgrade contact email\n\n**Path Parameters:**\n- `bot_id`: Bot UUID\n\n**Request Body:**\n- `source_type` (required): Must be \"html\"\n- `original_url` (required): Valid HTTP/HTTPS URL\n\n**URL Limits by Plan:**\n- Free plan: 1 URL per bot\n- Starter plan: 2 URLs per bot\n- Growth plan: 6 URLs per bot\n- Enterprise plan: 50 URLs per bot\n\n**Response:**\n- Returns created source with canonical URL\n- Source status starts as 'uploaded'\n- URL will be crawled and indexed in future phases\n- Automatically saves source_id to environment variable\n- Returns 400 with plan limit error if quota exceeded"
                    },
                    "response": []
                },
                {
                    "name": "List Sources",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/api/v1/bots/{{bot_id}}/sources",
                            "host": ["{{base_url}}"],
                            "path": [
                                "api",
                                "v1",
                                "bots",
                                "{{bot_id}}",
                                "sources"
                            ]
                        },
                        "description": "List all sources for a bot.\n\n**Authentication:** Required\n**Authorization:** Bot must belong to authenticated user\n**Path Parameters:**\n- `bot_id`: Bot UUID\n\n**Response:**\n- Returns list of sources (files and URLs)\n- Includes status, file size, timestamps\n- Ordered by creation date (newest first)\n- Shows error messages for failed sources"
                    },
                    "response": []
                },
                {
                    "name": "Get Source by ID",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/api/v1/bots/{{bot_id}}/sources/{{source_id}}",
                            "host": ["{{base_url}}"],
                            "path": [
                                "api",
                                "v1",
                                "bots",
                                "{{bot_id}}",
                                "sources",
                                "{{source_id}}"
                            ]
                        },
                        "description": "Get a specific source by ID.\n\n**Authentication:** Required\n**Authorization:** Bot must belong to authenticated user\n**Path Parameters:**\n- `bot_id`: Bot UUID\n- `source_id`: Source UUID\n\n**Response:**\n- Returns source details if found and authorized\n- Returns 404 if source not found\n- Returns 403 if user doesn't own the bot"
                    },
                    "response": []
                },
                {
                    "name": "Delete Source",
                    "request": {
                        "method": "DELETE",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/api/v1/bots/{{bot_id}}/sources/{{source_id}}",
                            "host": ["{{base_url}}"],
                            "path": [
                                "api",
                                "v1",
                                "bots",
                                "{{bot_id}}",
                                "sources",
                                "{{source_id}}"
                            ]
                        },
                        "description": "Delete a source.\n\n**Authentication:** Required\n**Authorization:** Bot must belong to authenticated user\n**Path Parameters:**\n- `bot_id`: Bot UUID\n- `source_id`: Source UUID\n\n**Warning:** This action cannot be undone. All associated data including chunks, embeddings, and the file in storage will be deleted.\n\n**Response:**\n- Returns success message\n- Returns 404 if source not found\n- Returns 403 if user doesn't own the bot"
                    },
                    "response": []
                }
            ],
            "description": "Source management endpoints for uploading files and submitting URLs to train bots"
        },
        {
            "name": "Chunk Management",
            "item": [
                {
                    "name": "List Chunks by Source",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/api/v1/bots/{{bot_id}}/sources/{{source_id}}/chunks",
                            "host": ["{{base_url}}"],
                            "path": [
                                "api",
                                "v1",
                                "bots",
                                "{{bot_id}}",
                                "sources",
                                "{{source_id}}",
                                "chunks"
                            ]
                        },
                        "description": "List all chunks for a specific source.\n\n**Authentication:** Required\n**Authorization:** Bot must belong to authenticated user\n**Path Parameters:**\n- `bot_id`: Bot UUID\n- `source_id`: Source UUID\n\n**Response:**\n- Returns chunks (excerpt, heading, char_range, tokens_estimate, created_at) ordered by chunk_index"
                    },
                    "response": []
                },
                {
                    "name": "List Chunks by Bot",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/api/v1/bots/{{bot_id}}/chunks",
                            "host": ["{{base_url}}"],
                            "path": [
                                "api",
                                "v1",
                                "bots",
                                "{{bot_id}}",
                                "chunks"
                            ]
                        },
                        "description": "List chunks for a bot across all sources (optional limit).\n\n**Authentication:** Required\n**Authorization:** Bot must belong to authenticated user\n**Query Params:**\n- `limit` (optional): number of chunks to return"
                    },
                    "response": []
                },
                {
                    "name": "Get Chunk by ID",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/api/v1/bots/{{bot_id}}/chunks/{{chunk_id}}",
                            "host": ["{{base_url}}"],
                            "path": [
                                "api",
                                "v1",
                                "bots",
                                "{{bot_id}}",
                                "chunks",
                                "{{chunk_id}}"
                            ]
                        },
                        "description": "Get a single chunk by ID.\n\n**Authentication:** Required\n**Authorization:** Bot must belong to authenticated user\n**Path Parameters:**\n- `bot_id`: Bot UUID\n- `chunk_id`: Chunk UUID"
                    },
                    "response": []
                }
            ],
            "description": "Chunk management endpoints for viewing chunks created from sources"
        },
        {
            "name": "Query (RAG)",
            "item": [
                {
                    "name": "Ask Bot",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"query_text\": \"What does this bot know about our docs?\",\n  \"top_k\": 5,\n  \"min_score\": 0.25,\n  \"session_id\": \"dev-session-123\",\n  \"page_url\": \"https://localhost/test\",\n  \"chat_history\": [\n    {\n      \"text\": \"What is the product?\",\n      \"isUser\": true,\n      \"timestamp\": \"2024-01-01T00:00:00Z\"\n    },\n    {\n      \"text\": \"Our product is an AI assistant.\",\n      \"isUser\": false,\n      \"timestamp\": \"2024-01-01T00:00:01Z\"\n    }\n  ],\n  \"include_metadata\": false\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/v1/bots/{{bot_id}}/query",
                            "host": ["{{base_url}}"],
                            "path": ["api", "v1", "bots", "{{bot_id}}", "query"]
                        },
                        "description": "Run a RAG query against a bot (authenticated endpoint).\n\n**Authentication:** Required\n**Authorization:** Bot must belong to authenticated user\n**Plan Limits:**\n- Checked against `max_queries_per_bot_per_day` from bot owner's plan\n- Daily limit resets at midnight UTC\n- Returns 400 error if daily query limit is reached\n- Error message includes plan details and upgrade contact email\n- Free plan: 20 queries per bot per day\n- Starter plan: 250 queries per bot per day\n- Growth/Enterprise: Unlimited queries\n\n**Path Parameters:**\n- `bot_id`: Bot UUID\n\n**Request Body:**\n- `query_text` (required): User's question\n- `top_k` (optional): Number of chunks to retrieve (1-20, default: 5)\n- `min_score` (optional): Minimum similarity score (0.0-1.0, default: 0.25)\n- `session_id` (optional): Session identifier for chat history\n- `page_url` (optional): Origin URL of the query\n- `chat_history` (optional): Previous chat messages from client (last 5 messages)\n  - Format: Array of `{text: string, isUser: boolean, timestamp?: string}`\n- `include_metadata` (optional): Include detailed source metadata (default: false)\n\n**Response:**\n- Returns answer with citations\n- Includes session_id and page_url in response\n- Chat history included in LLM context if provided\n- Returns 400 with plan limit error if daily quota exceeded"
                    },
                    "response": []
                },
                {
                    "name": "Widget Query (Public)",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "type": "text/javascript",
                                "exec": [
                                    "if (pm.response.code === 200) {",
                                    "    var jsonData = pm.response.json();",
                                    "    if (jsonData.status === 'success' && jsonData.data) {",
                                    "        console.log('Query successful!');",
                                    "        console.log('Answer:', jsonData.data.answer);",
                                    "        console.log('Session ID:', jsonData.data.session_id);",
                                    "        console.log('Page URL:', jsonData.data.page_url);",
                                    "        if (jsonData.data.citations) {",
                                    "            console.log('Citations:', jsonData.data.citations.length);",
                                    "        }",
                                    "    }",
                                    "}"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Authorization",
                                "value": "Bearer {{widget_token}}",
                                "description": "Widget token (required for public widget queries)"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"query_text\": \"What does this bot know about our docs?\",\n  \"top_k\": 5,\n  \"min_score\": 0.25,\n  \"session_id\": \"widget_session_123\",\n  \"page_url\": \"https://example.com/page\",\n  \"chat_history\": [\n    {\n      \"text\": \"What is the product?\",\n      \"isUser\": true,\n      \"timestamp\": \"2024-01-01T00:00:00Z\"\n    },\n    {\n      \"text\": \"Our product is an AI assistant.\",\n      \"isUser\": false,\n      \"timestamp\": \"2024-01-01T00:00:01Z\"\n    }\n  ]\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/v1/widget/query",
                            "host": ["{{base_url}}"],
                            "path": ["api", "v1", "widget", "query"]
                        },
                        "description": "Public widget query endpoint for embedded widgets.\n\n**Authentication:** Widget token (via Authorization header or query parameter)\n**Authorization:** Token validates bot access (no user authentication required)\n\n**Request Body:**\n- `query_text` (required): User's question\n- `top_k` (optional): Number of chunks to retrieve (1-20, default: 5)\n- `min_score` (optional): Minimum similarity score (0.0-1.0, default: 0.25)\n- `session_id` (optional): Session identifier for chat history\n- `page_url` (optional): Origin URL of the query\n- `chat_history` (optional): Previous chat messages from client (last 5 messages)\n  - Format: Array of `{text: string, isUser: boolean, timestamp?: string}`\n  - Messages are paired (user + assistant) and included in LLM context\n\n**Response:**\n- Returns answer with lightweight citations (chunk IDs only)\n- Includes session_id and page_url in response\n- Chat history from client included in LLM context\n- CORS headers allow all origins\n\n**Token Format:**\n- Authorization header: `Bearer <token>` or `Token <token>`\n- Query parameter: `?token=<token>`\n\n**Note:**\n- Widget queries always exclude metadata for performance\n- Token determines which bot to query (extracted from token validation)\n- Origin validation based on token's allowed_domains (bypassed in dev mode for localhost)"
                    },
                    "response": []
                }
            ],
            "description": "RAG query endpoints for authenticated users and public widgets"
        },
        {
            "name": "Analytics",
            "item": [
                {
                    "name": "Get Analytics Summary",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/api/v1/bots/{{bot_id}}/analytics/summary?days=30",
                            "host": ["{{base_url}}"],
                            "path": [
                                "api",
                                "v1",
                                "bots",
                                "{{bot_id}}",
                                "analytics",
                                "summary"
                            ],
                            "query": [
                                {
                                    "key": "days",
                                    "value": "30",
                                    "description": "Number of days to look back (1-365)"
                                }
                            ]
                        },
                        "description": "Get summary analytics for a bot.\n\n**Authentication:** Required\n**Authorization:** Bot must belong to authenticated user\n**Path Parameters:**\n- `bot_id`: Bot UUID\n\n**Query Parameters:**\n- `days` (optional): Number of days to look back (1-365, default: 30)\n\n**Response:**\n- Returns summary statistics (total queries, average confidence, average latency, total tokens)"
                    },
                    "response": []
                },
                {
                    "name": "Get Top Queries",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/api/v1/bots/{{bot_id}}/analytics/queries?limit=10&days=30",
                            "host": ["{{base_url}}"],
                            "path": [
                                "api",
                                "v1",
                                "bots",
                                "{{bot_id}}",
                                "analytics",
                                "queries"
                            ],
                            "query": [
                                {
                                    "key": "limit",
                                    "value": "10",
                                    "description": "Number of top queries to return (1-50)"
                                },
                                {
                                    "key": "days",
                                    "value": "30",
                                    "description": "Number of days to look back (1-365)"
                                }
                            ]
                        },
                        "description": "Get top queries by frequency.\n\n**Authentication:** Required\n**Authorization:** Bot must belong to authenticated user\n**Plan Limits:**\n- Requires `analytics_tier: 'full'` (available on Starter, Growth, Enterprise plans)\n- Free plan returns empty array with upgrade message\n- Returns 200 with empty data for basic tier plans\n\n**Path Parameters:**\n- `bot_id`: Bot UUID\n\n**Query Parameters:**\n- `limit` (optional): Number of top queries to return (1-50, default: 10)\n- `days` (optional): Number of days to look back (1-365, default: 30)\n\n**Response:**\n- Returns list of top queries with frequency and average confidence\n- Returns empty array for basic analytics tier (free plan)"
                    },
                    "response": []
                },
                {
                    "name": "Get Unanswered Queries",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/api/v1/bots/{{bot_id}}/analytics/unanswered?limit=20&days=30",
                            "host": ["{{base_url}}"],
                            "path": [
                                "api",
                                "v1",
                                "bots",
                                "{{bot_id}}",
                                "analytics",
                                "unanswered"
                            ],
                            "query": [
                                {
                                    "key": "limit",
                                    "value": "20",
                                    "description": "Number of queries to return (1-100)"
                                },
                                {
                                    "key": "days",
                                    "value": "30",
                                    "description": "Number of days to look back (1-365)"
                                }
                            ]
                        },
                        "description": "Get queries that may not have been answered well.\n\n**Authentication:** Required\n**Authorization:** Bot must belong to authenticated user\n**Plan Limits:**\n- Requires `analytics_tier: 'full'` (available on Starter, Growth, Enterprise plans)\n- Free plan returns empty array with upgrade message\n- Returns 200 with empty data for basic tier plans\n\n**Path Parameters:**\n- `bot_id`: Bot UUID\n\n**Query Parameters:**\n- `limit` (optional): Number of queries to return (1-100, default: 20)\n- `days` (optional): Number of days to look back (1-365, default: 30)\n\n**Response:**\n- Returns list of queries with low confidence or empty sources\n- Returns empty array for basic analytics tier (free plan)"
                    },
                    "response": []
                },
                {
                    "name": "Get Usage Over Time",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/api/v1/bots/{{bot_id}}/analytics/usage?days=30",
                            "host": ["{{base_url}}"],
                            "path": [
                                "api",
                                "v1",
                                "bots",
                                "{{bot_id}}",
                                "analytics",
                                "usage"
                            ],
                            "query": [
                                {
                                    "key": "days",
                                    "value": "30",
                                    "description": "Number of days to look back (1-365)"
                                }
                            ]
                        },
                        "description": "Get token usage and query volume over time.\n\n**Authentication:** Required\n**Authorization:** Bot must belong to authenticated user\n**Path Parameters:**\n- `bot_id`: Bot UUID\n\n**Query Parameters:**\n- `days` (optional): Number of days to look back (1-365, default: 30)\n\n**Response:**\n- Returns daily usage statistics (date, queries, tokens, avg_confidence, avg_latency_ms)"
                    },
                    "response": []
                },
                {
                    "name": "Get Analytics Overview",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/api/v1/bots/{{bot_id}}/analytics/overview?days=30&top_limit=10&unanswered_limit=20",
                            "host": ["{{base_url}}"],
                            "path": [
                                "api",
                                "v1",
                                "bots",
                                "{{bot_id}}",
                                "analytics",
                                "overview"
                            ],
                            "query": [
                                {
                                    "key": "days",
                                    "value": "30",
                                    "description": "Number of days to look back (1-365)"
                                },
                                {
                                    "key": "top_limit",
                                    "value": "10",
                                    "description": "Number of top queries to return (1-50)"
                                },
                                {
                                    "key": "unanswered_limit",
                                    "value": "20",
                                    "description": "Number of unanswered queries to return (1-100)"
                                }
                            ]
                        },
                        "description": "Get all analytics sections in a single response.\n\n**Authentication:** Required\n**Authorization:** Bot must belong to authenticated user\n**Plan Limits:**\n- `top_queries` and `unanswered` only included for `analytics_tier: 'full'` plans\n- Free plan (basic tier) returns empty arrays for top_queries and unanswered\n- `summary` and `usage` are available on all plans\n- Response includes `analytics_tier` field indicating plan's tier\n\n**Path Parameters:**\n- `bot_id`: Bot UUID\n\n**Query Parameters:**\n- `days` (optional): Number of days to look back (1-365, default: 30)\n- `top_limit` (optional): Number of top queries to return (1-50, default: 10)\n- `unanswered_limit` (optional): Number of unanswered queries to return (1-100, default: 20)\n\n**Response:**\n- Returns combined analytics data (summary, top_queries, unanswered, usage, analytics_tier)\n- `top_queries` and `unanswered` are empty arrays for basic tier plans"
                    },
                    "response": []
                }
            ],
            "description": "Analytics endpoints for bot performance metrics and usage statistics"
        },
        {
            "name": "Prompt Updates",
            "item": [
                {
                    "name": "Generate Prompt from Feedback",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"feedback\": \"Make the responses more friendly and conversational. Always include citations when referring to sources.\"\n}",
                            "options": {
                                "raw": {
                                    "language": "json"
                                }
                            }
                        },
                        "url": {
                            "raw": "{{base_url}}/api/v1/bots/{{bot_id}}/prompt/generate",
                            "host": ["{{base_url}}"],
                            "path": [
                                "api",
                                "v1",
                                "bots",
                                "{{bot_id}}",
                                "prompt",
                                "generate"
                            ]
                        },
                        "description": "Generate an updated system prompt based on user feedback using AI.\n\n**Authentication:** Required\n**Authorization:** Bot must belong to authenticated user\n**Plan Limits:**\n- Requires `train_enabled: true` (available on Starter, Growth, Enterprise plans)\n- Free plan returns 403 Forbidden with upgrade message\n- Error message includes plan details and upgrade contact email\n\n**Path Parameters:**\n- `bot_id`: Bot UUID\n\n**Request Body:**\n- `feedback` (required): User feedback about what needs to be updated in the system prompt\n\n**Response:**\n- Returns generated prompt (not saved to database)\n- Includes current_prompt, updated_prompt, and feedback\n- Use this to preview changes before saving\n- Returns 403 for free plan users"
                    },
                    "response": []
                },
                {
                    "name": "Create Prompt Update",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "type": "text/javascript",
                                "exec": [
                                    "if (pm.response.code === 201) {",
                                    "    var jsonData = pm.response.json();",
                                    "    if (jsonData.data && jsonData.data.id) {",
                                    "        pm.environment.set('prompt_update_id', jsonData.data.id);",
                                    "        console.log('Prompt Update ID saved:', jsonData.data.id);",
                                    "    }",
                                    "}"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"new_prompt\": \"You are a friendly and helpful assistant. Answer questions clearly and always cite your sources.\",\n    \"reason\": \"Improved tone and added citation requirements\",\n    \"auto_apply\": false\n}",
                            "options": {
                                "raw": {
                                    "language": "json"
                                }
                            }
                        },
                        "url": {
                            "raw": "{{base_url}}/api/v1/bots/{{bot_id}}/prompt-updates",
                            "host": ["{{base_url}}"],
                            "path": [
                                "api",
                                "v1",
                                "bots",
                                "{{bot_id}}",
                                "prompt-updates"
                            ]
                        },
                        "description": "Create a new prompt update (saves to history).\n\n**Authentication:** Required\n**Authorization:** Bot must belong to authenticated user\n**Plan Limits:**\n- Requires `train_enabled: true` (available on Starter, Growth, Enterprise plans)\n- Free plan returns 403 Forbidden with upgrade message\n- Error message includes plan details and upgrade contact email\n\n**Path Parameters:**\n- `bot_id`: Bot UUID\n\n**Request Body:**\n- `new_prompt` (required): New system prompt text\n- `reason` (optional): Reason for the update (max 500 characters)\n- `auto_apply` (optional): Whether to automatically apply the update (default: false)\n  - If `true`: Prompt is saved and immediately applied to the bot\n  - If `false`: Prompt is saved to history but not applied (use Apply endpoint later)\n\n**Response:**\n- Returns created prompt update with ID\n- Automatically saves prompt_update_id to environment variable\n- If auto_apply=true, bot's system_prompt is updated immediately\n- Returns 403 for free plan users"
                    },
                    "response": []
                },
                {
                    "name": "List Prompt Updates",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/api/v1/bots/{{bot_id}}/prompt-updates?limit=50",
                            "host": ["{{base_url}}"],
                            "path": [
                                "api",
                                "v1",
                                "bots",
                                "{{bot_id}}",
                                "prompt-updates"
                            ],
                            "query": [
                                {
                                    "key": "limit",
                                    "value": "50",
                                    "description": "Maximum number of updates to return (1-100)"
                                }
                            ]
                        },
                        "description": "Get prompt update history for a bot.\n\n**Authentication:** Required\n**Authorization:** Bot must belong to authenticated user\n**Path Parameters:**\n- `bot_id`: Bot UUID\n\n**Query Parameters:**\n- `limit` (optional): Maximum number of updates to return (1-100)\n\n**Response:**\n- Returns list of prompt updates ordered by creation date (newest first)\n- Includes old_prompt, new_prompt, reason, auto_applied, created_at\n- Shows which updates were auto-applied vs saved for later"
                    },
                    "response": []
                },
                {
                    "name": "Apply Prompt Update",
                    "request": {
                        "method": "PATCH",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"update_id\": \"{{prompt_update_id}}\"\n}",
                            "options": {
                                "raw": {
                                    "language": "json"
                                }
                            }
                        },
                        "url": {
                            "raw": "{{base_url}}/api/v1/bots/{{bot_id}}/prompt",
                            "host": ["{{base_url}}"],
                            "path": [
                                "api",
                                "v1",
                                "bots",
                                "{{bot_id}}",
                                "prompt"
                            ]
                        },
                        "description": "Apply a prompt update to the bot.\n\n**Authentication:** Required\n**Authorization:** Bot must belong to authenticated user\n**Plan Limits:**\n- Requires `train_enabled: true` (available on Starter, Growth, Enterprise plans)\n- Free plan returns 403 Forbidden with upgrade message\n- Error message includes plan details and upgrade contact email\n\n**Path Parameters:**\n- `bot_id`: Bot UUID\n\n**Request Body:**\n- `update_id` (required): ID of the prompt update to apply\n\n**Response:**\n- Returns updated bot with new system_prompt\n- Updates bot's system_prompt field in database\n- Use this to apply a previously saved prompt update\n- Returns 403 for free plan users"
                    },
                    "response": []
                },
                {
                    "name": "Revert Prompt",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"update_id\": \"{{prompt_update_id}}\"\n}",
                            "options": {
                                "raw": {
                                    "language": "json"
                                }
                            }
                        },
                        "url": {
                            "raw": "{{base_url}}/api/v1/bots/{{bot_id}}/prompt/revert",
                            "host": ["{{base_url}}"],
                            "path": [
                                "api",
                                "v1",
                                "bots",
                                "{{bot_id}}",
                                "prompt",
                                "revert"
                            ]
                        },
                        "description": "Revert bot to a previous prompt version.\n\n**Authentication:** Required\n**Authorization:** Bot must belong to authenticated user\n**Plan Limits:**\n- Requires `train_enabled: true` (available on Starter, Growth, Enterprise plans)\n- Free plan returns 403 Forbidden with upgrade message\n- Error message includes plan details and upgrade contact email\n\n**Path Parameters:**\n- `bot_id`: Bot UUID\n\n**Request Body:**\n- `update_id` (required): ID of the prompt update to revert to (uses old_prompt from that update)\n\n**Response:**\n- Returns updated bot with reverted system_prompt\n- Creates a new prompt update record for the revert action\n- Bot's system_prompt is set to the old_prompt from the specified update\n- Returns 403 for free plan users"
                    },
                    "response": []
                }
            ],
            "description": "Prompt update endpoints for managing system prompt versions and history"
        },
        {
            "name": "Sandbox Query",
            "item": [
                {
                    "name": "Test Prompt in Sandbox",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"query_text\": \"What does this bot know about our documentation?\",\n    \"custom_prompt\": \"You are a helpful assistant. Answer questions clearly and always cite sources.\",\n    \"top_k\": 5,\n    \"min_score\": 0.25,\n    \"chat_history\": [\n        {\n            \"text\": \"What is the product?\",\n            \"isUser\": true,\n            \"timestamp\": \"2024-01-01T00:00:00Z\"\n        },\n        {\n            \"text\": \"Our product is an AI assistant.\",\n            \"isUser\": false,\n            \"timestamp\": \"2024-01-01T00:00:01Z\"\n        }\n    ],\n    \"include_metadata\": true\n}",
                            "options": {
                                "raw": {
                                    "language": "json"
                                }
                            }
                        },
                        "url": {
                            "raw": "{{base_url}}/api/v1/bots/{{bot_id}}/query/sandbox",
                            "host": ["{{base_url}}"],
                            "path": [
                                "api",
                                "v1",
                                "bots",
                                "{{bot_id}}",
                                "query",
                                "sandbox"
                            ]
                        },
                        "description": "Test a custom prompt without saving it to the bot.\n\n**Authentication:** Required\n**Authorization:** Bot must belong to authenticated user\n**Path Parameters:**\n- `bot_id`: Bot UUID\n\n**Request Body:**\n- `query_text` (required): User's question\n- `custom_prompt` (required): Custom system prompt to test\n- `top_k` (optional): Number of chunks to retrieve (1-20, default: 5)\n- `min_score` (optional): Minimum similarity score (0.0-1.0, default: 0.25)\n- `chat_history` (optional): Previous chat messages (last 5 messages)\n  - Format: Array of `{text: string, isUser: boolean, timestamp?: string}`\n- `include_metadata` (optional): Include detailed source metadata (default: true for sandbox)\n\n**Response:**\n- Returns answer with citations and confidence\n- Uses custom_prompt instead of bot's current system_prompt\n- Query is NOT logged to database (sandbox mode)\n- Use this to test prompt changes before applying them"
                    },
                    "response": []
                }
            ],
            "description": "Sandbox query endpoint for testing custom prompts without saving changes"
        }
    ],
    "event": [
        {
            "listen": "prerequest",
            "script": {
                "type": "text/javascript",
                "exec": [
                    "// Set default headers for all requests",
                    "pm.request.headers.add({",
                    "    key: 'User-Agent',",
                    "    value: 'Convot-API-Client/1.0'",
                    "});",
                    "",
                    "// Log request details",
                    "console.log('Request:', pm.request.method, pm.request.url);"
                ]
            }
        },
        {
            "listen": "test",
            "script": {
                "type": "text/javascript",
                "exec": [
                    "// Common test script for all requests",
                    "pm.test('Status code is valid', function () {",
                    "    pm.expect(pm.response.code).to.be.oneOf([200, 201, 400, 401, 403, 404, 422, 429, 500]);",
                    "});",
                    "",
                    "pm.test('Response has valid JSON', function () {",
                    "    pm.response.to.have.jsonBody();",
                    "});",
                    "",
                    "pm.test('Response time is acceptable', function () {",
                    "    pm.expect(pm.response.responseTime).to.be.below(5000);",
                    "});",
                    "",
                    "// Check for rate limiting",
                    "if (pm.response.code === 429) {",
                    "    pm.test('Rate limit exceeded', function () {",
                    "        pm.expect(pm.response.json()).to.have.property('detail');",
                    "    });",
                    "}",
                    "",
                    "// Log response details",
                    "console.log('Response:', pm.response.code, pm.response.status);"
                ]
            }
        }
    ],
    "variable": [
        {
            "key": "base_url",
            "value": "http://localhost:8000",
            "type": "string"
        },
        {
            "key": "widget_token",
            "value": "",
            "type": "string",
            "description": "Widget token for public widget queries (get from Create Widget Token endpoint)"
        },
        {
            "key": "prompt_update_id",
            "value": "",
            "type": "string",
            "description": "Prompt update ID (automatically saved from Create Prompt Update endpoint)"
        }
    ]
}
